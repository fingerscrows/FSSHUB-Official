<script>
    // URL GAS PROJEK KAMU
    const BASE_API = "https://script.google.com/macros/s/AKfycbyXXfyBzF7UdL39b0Q1lp6WWyba9EmVAXc6vrdPfJMMmM_YwzmP6RRPaWXGyPYUTt14RA/exec";
    // Token harus sama dengan yang ada di Google Apps Script
    const TOKEN = "SAYA_SUKA_FSSHUB_GANTENG"; 
    
    // Gabungkan URL dengan Token
    const API_URL = `${BASE_API}?token=${TOKEN}`;
    
    // Fungsi Copy (Tidak berubah)
    function copy() {
        const k = document.getElementById("key");
        k.select(); k.setSelectionRange(0,99999);
        document.execCommand("copy");
        
        const b = document.getElementById("btn");
        const originalText = b.innerText;
        b.innerText = "COPIED TO CLIPBOARD!"; 
        b.style.background = "#fff"; b.style.color = "#000";
        setTimeout(() => { b.innerText = originalText; b.style.background = ""; b.style.color = ""; }, 1500);
    }

    // Fungsi Fetch Key
    async function fetchKey() {
        try {
            document.getElementById("key").value = "CONTACTING SERVER...";
            
            // Fetch dengan Token
            const response = await fetch(API_URL);
            const text = await response.text();
            
            // Cek apakah server memberikan Key atau Menolak
            const match = text.match(/(KEY-[A-F0-9]+)/);
            
            if (match && match[1]) {
                document.getElementById("key").value = match[1];
                document.getElementById("loader").style.display = "none";
                document.getElementById("main").style.display = "block";
                document.getElementById("sess").innerText = Math.random().toString(36).substr(2, 8).toUpperCase();
                document.getElementById("time").innerText = "KEY STATUS: ACTIVE & SECURE";
            } else {
                // Jika token salah atau server error
                throw new Error("Access Denied by Server");
            }
        } catch (error) {
            console.error(error);
            document.getElementById("key").value = "ACCESS DENIED";
            document.getElementById("time").innerText = "Security Check Failed.";
            document.getElementById("loader").style.display = "none";
            document.getElementById("main").style.display = "block";
        }
    }

    setTimeout(fetchKey, 1200);
</script>
